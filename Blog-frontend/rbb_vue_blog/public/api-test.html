<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¥å£æµ‹è¯•</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
    }
    
    .test-section h3 {
      margin-top: 0;
      color: #555;
    }
    
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #0056b3;
    }
    
    .result {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 4px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    
    .loading {
      color: #007bff;
      font-style: italic;
    }
    
    .error {
      color: #dc3545;
    }
    
    .success {
      color: #28a745;
    }
    
    .params {
      margin: 10px 0;
    }
    
    .params label {
      display: inline-block;
      width: 100px;
      font-weight: bold;
    }
    
    .params input {
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>æ–‡ç« æ¥å£æµ‹è¯•é¡µé¢</h1>
    
    <!-- è·å–æ–‡ç« åˆ—è¡¨æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ“„ è·å–æ–‡ç« åˆ—è¡¨</h3>
      <div class="params">
        <label>é¡µç :</label>
        <input type="number" id="page" value="1" min="1">
        
        <label>æ¯é¡µæ•°é‡:</label>
        <input type="number" id="pageSize" value="10" min="1" max="1000">
        
        <label>çŠ¶æ€:</label>
        <input type="number" id="status" value="0" placeholder="0:å·²å‘å¸ƒ, 1:è‰ç¨¿">
        
        <label>åˆ†ç±»ID:</label>
        <input type="text" id="categoryId" placeholder="å¯é€‰">
      </div>
      <button onclick="testGetArticleList()">ğŸš€ æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨</button>
      <div id="articleListResult" class="result"></div>
    </div>
    
    <!-- è·å–æ–‡ç« è¯¦æƒ…æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ“– è·å–æ–‡ç« è¯¦æƒ…</h3>
      <div class="params">
        <label>æ–‡ç« ID:</label>
        <input type="text" id="articleId" value="1">
      </div>
      <button onclick="testGetArticleDetail()">ğŸš€ æµ‹è¯•è·å–æ–‡ç« è¯¦æƒ…</button>
      <div id="articleDetailResult" class="result"></div>
    </div>
    
    <!-- æ›´æ–°æµè§ˆé‡æµ‹è¯• -->
    <div class="test-section">
      <h3>ğŸ‘ï¸ æ›´æ–°æ–‡ç« æµè§ˆé‡</h3>
      <div class="params">
        <label>æ–‡ç« ID:</label>
        <input type="text" id="viewCountId" value="1">
      </div>
      <button onclick="testUpdateViewCount()">ğŸš€ æµ‹è¯•æ›´æ–°æµè§ˆé‡</button>
      <div id="viewCountResult" class="result"></div>
    </div>
  </div>

  <script>
    // æ¨¡æ‹ŸAPIé…ç½®
    const API_BASE_URL = 'http://localhost:7777';
    
    // é€šç”¨è¯·æ±‚å‡½æ•°
    async function makeRequest(url, options = {}) {
      const fullUrl = `${API_BASE_URL}${url}`;
      console.log('è¯·æ±‚URL:', fullUrl);
      
      try {
        const response = await fetch(fullUrl, {
          headers: {
            'Content-Type': 'application/json',
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è®¤è¯å¤´
            // 'Authorization': 'Bearer ' + token
          },
          ...options
        });
        
        const data = await response.json();
        console.log('å“åº”æ•°æ®:', data);
        return data;
      } catch (error) {
        console.error('è¯·æ±‚å¤±è´¥:', error);
        throw error;
      }
    }
    
    // æ˜¾ç¤ºç»“æœ
    function showResult(elementId, data, isError = false) {
      const element = document.getElementById(elementId);
      if (isError) {
        element.className = 'result error';
        element.textContent = `âŒ é”™è¯¯: ${data.message || data}`;
      } else {
        element.className = 'result success';
        element.textContent = `âœ… æˆåŠŸ:\n${JSON.stringify(data, null, 2)}`;
      }
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading(elementId) {
      const element = document.getElementById(elementId);
      element.className = 'result loading';
      element.textContent = 'â³ åŠ è½½ä¸­...';
    }
    
    // æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨
    async function testGetArticleList() {
      const resultId = 'articleListResult';
      showLoading(resultId);
      
      try {
        const page = document.getElementById('page').value || 1;
        const pageSize = document.getElementById('pageSize').value || 10;
        const status = document.getElementById('status').value || 0;
        const categoryId = document.getElementById('categoryId').value;
        
        let params = new URLSearchParams({
          page: page,
          pageSize: pageSize,
          status: status
        });
        
        if (categoryId) {
          params.append('categoryId', categoryId);
        }
        
        const url = `/article/articleList?${params.toString()}`;
        const data = await makeRequest(url);
        
        showResult(resultId, data);
        
        // å¦‚æœæˆåŠŸï¼Œæ˜¾ç¤ºä¸€äº›ç»Ÿè®¡ä¿¡æ¯
        if (data.code === '200' || data.code === 200) {
          const summary = {
            total: data.data.total,
            count: data.data.rows.length,
            articles: data.data.rows.map(article => ({
              id: article.id,
              title: article.title,
              category: article.categoryName,
              viewCount: article.viewCount
            }))
          };
          
          setTimeout(() => {
            const element = document.getElementById(resultId);
            element.textContent = `âœ… æˆåŠŸè·å–æ–‡ç« åˆ—è¡¨:\næ€»æ•°: ${summary.total}\nå½“å‰é¡µæ•°é‡: ${summary.count}\n\nè¯¦ç»†æ•°æ®:\n${JSON.stringify(data, null, 2)}`;
          }, 100);
        }
        
      } catch (error) {
        showResult(resultId, error, true);
      }
    }
    
    // æµ‹è¯•è·å–æ–‡ç« è¯¦æƒ…
    async function testGetArticleDetail() {
      const resultId = 'articleDetailResult';
      showLoading(resultId);
      
      try {
        const articleId = document.getElementById('articleId').value;
        if (!articleId) {
          throw new Error('è¯·è¾“å…¥æ–‡ç« ID');
        }
        
        const url = `/article/${articleId}`;
        const data = await makeRequest(url);
        
        showResult(resultId, data);
        
      } catch (error) {
        showResult(resultId, error, true);
      }
    }
    
    // æµ‹è¯•æ›´æ–°æµè§ˆé‡
    async function testUpdateViewCount() {
      const resultId = 'viewCountResult';
      showLoading(resultId);
      
      try {
        const articleId = document.getElementById('viewCountId').value;
        if (!articleId) {
          throw new Error('è¯·è¾“å…¥æ–‡ç« ID');
        }
        
        const url = `/article/updateViewCount/${articleId}`;
        const data = await makeRequest(url, {
          method: 'PUT'
        });
        
        showResult(resultId, data);
        
      } catch (error) {
        showResult(resultId, error, true);
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ æ–‡ç« æ¥å£æµ‹è¯•é¡µé¢å·²åŠ è½½');
      console.log('APIåŸºç¡€URL:', API_BASE_URL);
      
      // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¸€äº›åˆå§‹åŒ–é€»è¾‘
      const articleListResult = document.getElementById('articleListResult');
      articleListResult.textContent = 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•æ¥å£...';
      articleListResult.className = 'result';
      
      const articleDetailResult = document.getElementById('articleDetailResult');
      articleDetailResult.textContent = 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•æ¥å£...';
      articleDetailResult.className = 'result';
      
      const viewCountResult = document.getElementById('viewCountResult');
      viewCountResult.textContent = 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•æ¥å£...';
      viewCountResult.className = 'result';
    });
  </script>
</body>
</html>
